import { preferences } from '@kit.ArkData'
import { Context } from '@kit.AbilityKit'
// ç§»é™¤å¯¹å·²åˆ é™¤çš„ LanguageService çš„ä¾èµ–

/**
 * è¯­è¨€é€‰é¡¹æ¥å£
 */
export interface LanguageOption {
  code: string
  name: string
  nativeName: string
}

/**
 * å¤šè¯­è¨€å­—å…¸ç±»å‹
 */
type Dictionary = Record<string, string>
type LanguageDictionaries = Record<string, Dictionary>

/**
 * æ¨¡æ¿å‚æ•°ç±»å‹
 */
type TemplateParams = Record<string, string | number>

/**
 * I18næœåŠ¡ç±» - åº”ç”¨å†…å­—å…¸å‹å¤šè¯­è¨€æ”¯æŒ
 * ä¼˜åŠ¿ï¼šç«‹å³ç”Ÿæ•ˆã€è·¨ç‰ˆæœ¬ä¸€è‡´ã€ä¸ä¾èµ–èµ„æºç³»ç»Ÿçƒ­åˆ‡æ¢
 */
export class I18nService {
  private static instance: I18nService
  
  // å½“å‰è¯­è¨€çŠ¶æ€ - å•ä¸€æ•°æ®æº
  private currentLang: string = 'zh-CN'
  
  // è¯­è¨€å­—å…¸
  private dictionaries: LanguageDictionaries = {}
  
  // Preferenceså­˜å‚¨
  private preferences: preferences.Preferences | null = null
  
  // æ”¯æŒçš„è¯­è¨€åˆ—è¡¨
  private supportedLanguages: LanguageOption[] = [
    { code: 'zh-CN', name: 'ç®€ä½“ä¸­æ–‡', nativeName: 'ç®€ä½“ä¸­æ–‡' },
    { code: 'en-US', name: 'English', nativeName: 'English' }
  ]

  private constructor() {
    this.initDictionaries()
  }

  static getInstance(): I18nService {
    if (!I18nService.instance) {
      I18nService.instance = new I18nService()
    }
    return I18nService.instance
  }

  /**
   * åˆå§‹åŒ–å­—å…¸æ•°æ®
   */
  private initDictionaries(): void {
    // ä¸­æ–‡å­—å…¸
    this.dictionaries['zh-CN'] = {
      // åº”ç”¨åŸºç¡€
      'app_name': 'æ‘©æ–¯ç”µç é€š',
      'app_tagline': 'è®©å­¦ä¹ æ‘©æ–¯ç”µç ç®€å•åˆæœ‰è¶£',
      
      // ä¸»å¯¼èˆª
      'learn': 'å­¦ä¹ ',
      'practice': 'ç»ƒä¹ ', 
      'translate': 'ç¿»è¯‘',
      'code_table': 'ç è¡¨',
      'me': 'æˆ‘',
      
      // é€šç”¨æ“ä½œ
      'confirm': 'ç¡®è®¤',
      'cancel': 'å–æ¶ˆ',
      'close': 'ç¡®å®š',
      'back': 'è¿”å›',
      'next': 'ä¸‹ä¸€æ­¥',
      'loading': 'åŠ è½½ä¸­...',
      'copied': 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿',
      'got_it': 'çŸ¥é“äº†',
      'settings': 'è®¾ç½®',
      'sound': 'å£°éŸ³',
      
      // è¯­è¨€è®¾ç½®
      'language': 'è¯­è¨€',
      'language_selection_title': 'é€‰æ‹©è¯­è¨€',
      'language_selection_content': 'é€‰æ‹©æ‚¨åå¥½çš„åº”ç”¨ç•Œé¢è¯­è¨€',
      'chinese': 'ä¸­æ–‡',
      'english': 'English',
      'language_switched': 'è¯­è¨€å·²åˆ‡æ¢ä¸ºä¸­æ–‡',
      'language_switch_failed': 'è¯­è¨€åˆ‡æ¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',
      
      // å­¦ä¹ æ¨¡å—
      'morse_code_basics': 'æ‘©æ–¯ç”µç åŸºç¡€',
      'morse_code_intro': 'æ‘©æ–¯ç”µç æ˜¯ä¸€ç§ä»¥"ç‚¹ï¼ˆÂ·ï¼‰å’Œåˆ’ï¼ˆ-ï¼‰"ä¸ºåŸºæœ¬å…ƒç´ çš„å­—ç¬¦ç¼–ç ç³»ç»Ÿã€‚é€šè¿‡ä¸åŒçš„ç‚¹åˆ’ç»„åˆæ¥è¡¨ç¤ºå­—æ¯ã€æ•°å­—å’Œç¬¦å·ã€‚',
      'alphabet_lesson': 'å­—æ¯',
      'number_lesson': 'æ•°å­—',
      'punctuation_lesson': 'ç¬¦å·',
      'word_lesson': 'å•è¯',
      'review_lesson': 'å¤ä¹ ',
      'lesson_completed': 'å®Œæˆ',
      'next_lesson': 'ä¸‹ä¸€è¯¾',
      'start_test': 'å¼€å§‹æµ‹è¯•',
      'your_score': 'ä½ çš„åˆ†æ•°',
      'congratulations_passed': 'æ­å–œé€šè¿‡ï¼',
      'keep_trying': 'ç»§ç»­åŠªåŠ›ï¼',
      
      // ç»ƒä¹ æ¨¡å—
      'easy': 'ç®€å•',
      'medium': 'ä¸­ç­‰', 
      'hard': 'å›°éš¾',
      'easy_desc': 'ä»…å­—æ¯',
      'medium_desc': 'å­—æ¯ + æ•°å­—',
      'hard_desc': 'å…¨éƒ¨å­—ç¬¦',
      'favorites': 'æ”¶è—',
      'mistakes': 'é”™é¢˜æœ¬',
      'practice_again': 'å†æ¬¡ç»ƒä¹ ',
      'practice_count': 'ç»ƒä¹ æ¬¡æ•°',
      'congratulations_completed': 'æ­å–œå®Œæˆï¼',
      'favorite_added': 'å·²æ”¶è—',
      'favorite_removed': 'å·²å–æ¶ˆæ”¶è—',
      'practice_records': 'ç»ƒä¹ è®°å½•',
      'practiced': 'å·²ç»ƒä¹ ',
      'total': 'æ€»è®¡',
      'learning_completed': 'å®Œæˆå­¦ä¹ ',
      'you_mastered_basics': 'ä½ å·²ç»æŒæ¡äº†æ‘©æ–¯ç”µç çš„åŸºç¡€çŸ¥è¯†',
      'need_100_to_pass': 'éœ€è¦100åˆ†æ‰èƒ½é€šè¿‡æµ‹è¯•',
      'test_your_mastery': 'æµ‹è¯•ä½ å¯¹æœ¬è¯¾ç¨‹çš„æŒæ¡ç¨‹åº¦',
      'test_your_mastery_text': 'æµ‹è¯•ä½ å¯¹{title}çš„æŒæ¡ç¨‹åº¦',
      'test_content': 'æµ‹è¯•å†…å®¹',
      'test_format_1': 'â€¢ 2é“åˆ¤æ–­é¢˜ï¼ˆæ¯é¢˜20åˆ†ï¼‰',
      'test_format_2': 'â€¢ 3é“é€‰æ‹©é¢˜ï¼ˆæ¯é¢˜20åˆ†ï¼‰',
      'retake_test': 'é‡æ–°æµ‹è¯•',
      'next_question': 'ä¸‹ä¸€é¢˜',
      'view_results': 'æŸ¥çœ‹ç»“æœ',
      'correct': 'æ­£ç¡®',
      'wrong': 'é”™è¯¯',
        
        // åŸºç¡€æµ‹è¯•é—®é¢˜å’Œé€‰é¡¹
        'q1_question': 'æ‘©æ–¯ç”µç æ˜¯ä»¥"ç‚¹ï¼ˆÂ·ï¼‰å’Œåˆ’ï¼ˆ-ï¼‰"ä¸ºåŸºæœ¬å…ƒç´ çš„å­—ç¬¦ç¼–ç ç³»ç»Ÿã€‚',
        'q1_options': 'æ­£ç¡®,é”™è¯¯',
        'q2_question': 'SOSä¿¡å·çš„æ‘©æ–¯ç”µç æ˜¯ Â·Â·Â· --- Â·Â·Â·ï¼Œå„å­—ç¬¦ä¹‹é—´éœ€è¦ä¿æŒæ­£å¸¸çš„å­—ç¬¦é—´éš”ã€‚',
        'q2_options': 'æ­£ç¡®,é”™è¯¯',
        'q3_question': 'æ‘©æ–¯ç”µç çš„æ—¶åºè§„åˆ™ä¸­ï¼Œç‚¹ã€åˆ’ã€å­—ç¬¦é—´éš”çš„å•ä½æ¯”ä¾‹æ˜¯ï¼š',
        'q3_options': '1 : 2 : 5,1 : 3 : 7,1 : 4 : 8,2 : 3 : 6',
        'q4_question': 'æ‘©æ–¯ç”µç æ˜¯åœ¨å“ªä¸ªå¹´ä»£å¼€å‘çš„ï¼Ÿ',
        'q4_options': '1820 å¹´ä»£,1830-1840 å¹´ä»£,1850 å¹´ä»£,1860 å¹´ä»£',
        'q5_question': 'å­¦ä¹ æ‘©æ–¯ç”µç çš„å»ºè®®é¡ºåºæ˜¯ï¼š',
        'q5_options': 'æ•°å­— â†’ å­—æ¯ â†’ ç¬¦å·,ç¬¦å· â†’ å­—æ¯ â†’ æ•°å­—,å­—æ¯ â†’ æ•°å­— â†’ ç¬¦å·,éšæœºå­¦ä¹ ',
        
        // ä¸­æ–‡æ‘©æ–¯ç”µç æµ‹è¯•é—®é¢˜å’Œé€‰é¡¹
        'cq1_question': 'ä¸­æ–‡æ‘©å°”æ–¯ç”µç æ˜¯ä¸“é—¨ä¸ºä¸­æ–‡æ±‰å­—è®¾è®¡çš„æ‘©å°”æ–¯ç”µç ç³»ç»Ÿã€‚',
        'cq1_options': 'æ­£ç¡®,é”™è¯¯',
        'cq2_question': 'ä¸­æ–‡æ‘©å°”æ–¯ç”µç çš„ç¼–ç é•¿åº¦é€šå¸¸æ¯”è‹±æ–‡æ‘©å°”æ–¯ç”µç çŸ­ã€‚',
        'cq2_options': 'æ­£ç¡®,é”™è¯¯',
        'cq3_question': 'ä¸­æ–‡æ‘©å°”æ–¯ç”µç æ˜¯åœ¨å“ªä¸ªå¹´ä»£å¼€å§‹åˆ¶å®šçš„ï¼Ÿ',
        'cq3_options': '1900 å¹´ä»£,1920 å¹´ä»£,1950 å¹´ä»£,1980 å¹´ä»£',
        'cq4_question': 'ä»¥ä¸‹å“ªä¸ªä¸æ˜¯ä¸­æ–‡æ‘©å°”æ–¯ç”µç çš„åº”ç”¨åœºæ™¯ï¼Ÿ',
        'cq4_options': 'å†›äº‹é€šä¿¡,èˆªç©ºé€šä¿¡,ç½‘ç»œèŠå¤©,èˆªæµ·é€šä¿¡',
        'cq5_question': 'å­¦ä¹ ä¸­æ–‡æ‘©å°”æ–¯ç”µç çš„å»ºè®®é¡ºåºæ˜¯ï¼š',
        'cq5_options': 'ä»å¤æ‚æ±‰å­—å¼€å§‹,ä»åŸºç¡€æ±‰å­—å¼€å§‹,éšæœºå­¦ä¹ ,ä»æ ‡ç‚¹ç¬¦å·å¼€å§‹',
        
        // åŸºç¡€æµ‹è¯•è§£é‡Šå†…å®¹
        'exp1_title': 'æ‘©æ–¯ç”µç åŸºæœ¬å…ƒç´ ',
        'exp1_content': 'â€¢ æ‘©æ–¯ç”µç ä»¥"ç‚¹ï¼ˆÂ·ï¼‰å’Œåˆ’ï¼ˆ-ï¼‰"ä¸ºåŸºæœ¬å…ƒç´ \nâ€¢ é€šè¿‡ä¸åŒçš„ç‚¹åˆ’ç»„åˆè¡¨ç¤ºå­—æ¯ã€æ•°å­—å’Œç¬¦å·\nâ€¢ è¿™æ˜¯æ‰€æœ‰æ‘©æ–¯ç”µç çš„åŸºç¡€ï¼Œå¿…é¡»ç†Ÿç»ƒæŒæ¡',
        'exp2_title': 'SOSä¿¡å·çš„ç‰¹æ®Šæ€§',
        'exp2_content': 'â€¢ SOSæ˜¯ç´§æ€¥æ±‚æ•‘ä¿¡å·ï¼Œéœ€è¦å¿«é€Ÿè¯†åˆ«\nâ€¢ ç´§å‡‘å‘é€ï¼šä¸‰ä¸ªå­—ç¬¦ï¼ˆÂ·Â·Â· --- Â·Â·Â·ï¼‰æ˜¯ç´§å‡‘å‘é€çš„ï¼Œæ²¡æœ‰æ­£å¸¸çš„å­—ç¬¦é—´éš”\nâ€¢ æ ‡å‡†é—´éš”è§„åˆ™ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‘©æ–¯ç”µç å­—ç¬¦ä¹‹é—´åº”è¯¥æœ‰3ä¸ªå•ä½çš„é—´éš”\nâ€¢ SOSä¾‹å¤–ï¼šä½†SOSä½œä¸ºç´§æ€¥ä¿¡å·ï¼Œä¼šå¿½ç•¥è¿™ä¸ªè§„åˆ™ï¼Œç´§å‡‘å‘é€ä»¥æé«˜è¯†åˆ«é€Ÿåº¦',
        'exp3_title': 'æ—¶åºè§„åˆ™çš„é‡è¦æ€§',
        'exp3_content': 'â€¢ 1:3:7æ¯”ä¾‹æ˜¯æ‘©æ–¯ç”µç çš„æ ¸å¿ƒè§„åˆ™\nâ€¢ ç‚¹=1å•ä½ï¼Œåˆ’=3å•ä½ï¼Œå­—ç¬¦é—´éš”=3å•ä½ï¼Œå•è¯é—´éš”=7å•ä½\nâ€¢ è¿™ä¸ªç²¾ç¡®çš„æ—¶åºç¡®ä¿äº†ä¿¡æ¯ä¼ è¾“çš„å‡†ç¡®æ€§å’Œå¯è¯»æ€§',
        'exp4_title': 'å†å²èƒŒæ™¯',
        'exp4_content': 'â€¢ å¡ç¼ªå°”Â·æ‘©æ–¯ä¸é˜¿å°”å¼—é›·å¾·Â·éŸ¦å°”åœ¨1830-1840 å¹´ä»£åˆä½œå¼€å‘\nâ€¢ æœ€åˆç”¨äºç”µæŠ¥ç³»ç»Ÿï¼Œåæ¥æ¼”åŒ–ä¸ºå›½é™…æ‘©æ–¯ç”µç \nâ€¢ æˆä¸ºå…¨çƒæ ‡å‡†çš„æ— çº¿ç”µé€šä¿¡ç¼–ç ç³»ç»Ÿ',
        'exp5_title': 'å­¦ä¹ ç­–ç•¥',
        'exp5_content': 'â€¢ å­—æ¯ â†’ æ•°å­— â†’ ç¬¦å·çš„å­¦ä¹ é¡ºåºæœ€ç§‘å­¦\nâ€¢ å…ˆæŒæ¡åŸºç¡€å­—æ¯ï¼Œå†å­¦ä¹ æ•°å­—å’Œç¬¦å·\nâ€¢ å¾ªåºæ¸è¿›ï¼Œé¿å…ä¿¡æ¯è¿‡è½½ï¼Œæé«˜å­¦ä¹ æ•ˆç‡',
        
        // ä¸­æ–‡æ‘©æ–¯ç”µç æµ‹è¯•è§£é‡Šå†…å®¹
        'cexp1_title': 'ä¸­æ–‡æ‘©å°”æ–¯ç”µç çš„å®šä¹‰',
        'cexp1_content': 'â€¢ ä¸­æ–‡æ‘©å°”æ–¯ç”µç æ˜¯ä¸“é—¨ä¸ºä¸­æ–‡æ±‰å­—è®¾è®¡çš„ç¼–ç ç³»ç»Ÿ\nâ€¢ é€šè¿‡ç‚¹ï¼ˆÂ·ï¼‰å’Œåˆ’ï¼ˆ-ï¼‰çš„ç»„åˆè¡¨ç¤ºä¸­æ–‡å­—ç¬¦\nâ€¢ ç»“åˆäº†ä¼ ç»Ÿæ‘©å°”æ–¯ç”µç åŸç†å’Œä¸­æ–‡è¯­è¨€ç‰¹ç‚¹\nâ€¢ ä¸ºä¸­æ–‡é€šä¿¡æä¾›äº†æ ‡å‡†åŒ–çš„ç¼–ç æ–¹æ¡ˆ',
        'cexp2_title': 'ç¼–ç é•¿åº¦çš„ç‰¹ç‚¹',
        'cexp2_content': 'â€¢ ä¸­æ–‡æ‘©å°”æ–¯ç”µç çš„ç¼–ç é€šå¸¸æ¯”è‹±æ–‡æ›´é•¿\nâ€¢ è¿™æ˜¯å› ä¸ºä¸­æ–‡å­—ç¬¦æ•°é‡åºå¤§ï¼Œéœ€è¦æ›´å¤šç‚¹åˆ’ç»„åˆ\nâ€¢ æ¯ä¸ªæ±‰å­—éƒ½æœ‰å”¯ä¸€çš„æ‘©å°”æ–¯ç”µç è¡¨ç¤º\nâ€¢ ç¼–ç é•¿åº¦å¢åŠ æ˜¯ä¸ºäº†ç¡®ä¿å­—ç¬¦çš„å”¯ä¸€æ€§',
        'cexp3_title': 'å†å²å‘å±•èƒŒæ™¯',
        'cexp3_content': 'â€¢ 1920 å¹´ä»£ï¼šåˆæ­¥åˆ¶å®šä¸­æ–‡æ‘©å°”æ–¯ç”µç æ ‡å‡†\nâ€¢ å½“æ—¶ä¸ºäº†é€‚åº”ä¸­æ–‡ç”µæŠ¥é€šä¿¡çš„éœ€æ±‚\nâ€¢ å›½é™…ç”µä¿¡è”ç›Ÿï¼ˆITUï¼‰å‚ä¸åˆ¶å®š\nâ€¢ ç»è¿‡å¤šæ¬¡ä¼˜åŒ–å½¢æˆç°ä»£æ ‡å‡†',
        'cexp4_title': 'åº”ç”¨åœºæ™¯åˆ†æ',
        'cexp4_content': 'â€¢ å†›äº‹é€šä¿¡ï¼šéƒ¨é˜Ÿé—´çš„ç§˜å¯†é€šä¿¡\nâ€¢ èˆªç©ºé€šä¿¡ï¼šé£è¡Œå‘˜ä¸åœ°é¢æ§åˆ¶å¡”é€šä¿¡\nâ€¢ èˆªæµ·é€šä¿¡ï¼šèˆ¹èˆ¶é—´é€šä¿¡\nâ€¢ ç½‘ç»œèŠå¤©ä¸å±äºä¼ ç»Ÿåº”ç”¨åœºæ™¯',
        'cexp5_title': 'å­¦ä¹ ç­–ç•¥å»ºè®®',
        'cexp5_content': 'â€¢ ä»åŸºç¡€æ±‰å­—å¼€å§‹å­¦ä¹ æœ€ç§‘å­¦\nâ€¢ åŸºç¡€æ±‰å­—ä½¿ç”¨é¢‘ç‡é«˜ï¼Œå®¹æ˜“è®°å¿†\nâ€¢ å¾ªåºæ¸è¿›ï¼Œé¿å…ä¿¡æ¯è¿‡è½½\nâ€¢ å»ºç«‹å­¦ä¹ ä¿¡å¿ƒï¼Œæé«˜å­¦ä¹ æ•ˆç‡',
      
      // ç¿»è¯‘æ¨¡å—
      'text_to_morse': 'æ–‡æœ¬ â†’ ç”µç ',
      'morse_to_text': 'ç”µç  â†’ æ–‡æœ¬',
      'input_text_placeholder': 'åœ¨æ­¤è¾“å…¥æ–‡æœ¬ï¼Œå¦‚: Hello World',
      'input_morse_placeholder': 'åœ¨æ­¤è¾“å…¥ç”µç ï¼Œå¦‚: Â·Â·Â· --- Â·Â·Â·',
      'output_text_placeholder': 'ç”µç å°†åœ¨æ­¤æ˜¾ç¤º',
      'output_morse_placeholder': 'æ–‡æœ¬å°†åœ¨æ­¤æ˜¾ç¤º',
      
      // ç è¡¨æ¨¡å—
      'standard_chinese_telegraph_code': 'æ ‡å‡†ä¸­æ–‡ç”µç ',
      'chinese_characters': 'æ±‰å­—',
      'telegraph_code': 'ç”µç ',
      'searching': 'æœç´¢ä¸­...',
      'no_data': 'æš‚æ— æ•°æ®',
      
      // ä¸ªäººä¸­å¿ƒ
      'rating_feedback': 'è¯„åˆ†å’Œåé¦ˆ',
      'share_app': 'åˆ†äº«åº”ç”¨',
      'other_apps': 'å…¶ä»–åº”ç”¨',
      'version': 'ç‰ˆæœ¬',
      'copyright': 'Â© 2025 é‡åº†è±†èŠ±ç§‘æŠ€æœ‰é™å…¬å¸',
      
      
      // åˆ†äº«å†…å®¹
      'share_text': 'æ¨èä¸€æ¬¾å­¦ä¹ æ‘©å°”æ–¯ç”µç çš„åº”ç”¨ï¼š\nã€Šæ‘©æ–¯ç”µç é€šã€‹ğŸ“¡\n\nâ€¢ ä»é›¶å­¦ä¹ æ‘©å°”æ–¯ç”µç \nâ€¢ è·Ÿè¯»ç»ƒä¹ ä¸å¬åŠ›è®­ç»ƒ\nâ€¢ æ–‡æœ¬ä¸æ‘©æ–¯äº’ç›¸ç¿»è¯‘\n\nç«‹å³ä¸‹è½½ï¼š\nhttps://appgallery.huawei.com/app/detail?id=com.douhua.morsecode',
      'share_copied': 'åˆ†äº«å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿',
      
      // è¯¾ç¨‹æ ‡é¢˜ - æ¯ä¸ªå•å…ƒå†…éƒ¨ç¼–å·
      'lesson_1': 'ç¬¬ 1 è¯¾',
      'lesson_2': 'ç¬¬ 2 è¯¾', 
      'lesson_3': 'ç¬¬ 3 è¯¾',
      'lesson_4': 'ç¬¬ 4 è¯¾',
      'lesson_5': 'ç¬¬ 5 è¯¾',
      'lesson_6': 'ç¬¬ 6 è¯¾',
      'lesson_7': 'ç¬¬ 7 è¯¾',
      'lesson_8': 'ç¬¬ 8 è¯¾',
      'lesson_9': 'ç¬¬ 9 è¯¾',
      'alphabet_abc': 'A B C',
      'alphabet_def': 'D E F',
      'alphabet_ghij': 'G H I J',
      'alphabet_review_aj': 'å¤ä¹ ï¼šA-J',
      'alphabet_klmn': 'K L M N',
      'alphabet_opqr': 'O P Q R',
      'alphabet_stuv': 'S T U V',
      'alphabet_wxyz': 'W X Y Z',
      'alphabet_review_kz': 'å¤ä¹ ï¼šK-Z',
      'numbers_123': '1 2 3',
      'numbers_456': '4 5 6',
      'numbers_7890': '7 8 9 0',
      'numbers_review': 'å¤ä¹ ï¼š0-9',
      'punctuation_basic': '. , ? ! : ;',
      'punctuation_advanced': '= + - _ " \' ( ) / @',
      'punctuation_review': 'å¤ä¹ ',
      'words_3letter': '3å­—æ¯å•è¯',
      'words_4letter': '4å­—æ¯å•è¯',
      'words_5letter': '5å­—æ¯å•è¯',
      'all_codes': 'æ‰€æœ‰ç ',
      'letters': 'å­—æ¯',
      'numbers': 'æ•°å­—',
      'punctuation': 'æ ‡ç‚¹ç¬¦å·',
      'practice_favorites': 'ç»ƒä¹ æ”¶è—çš„å­—æ¯',
      'mistakes_desc': 'å¤ä¹ åšé”™çš„å­—æ¯',
      'favorites_empty': 'æ”¶è—å¤¹ä¸ºç©ºï¼Œå…ˆå»ç»ƒä¹ ä¸€äº›å­—æ¯å§ï¼',
      'mistakes_empty': 'é”™é¢˜æœ¬ä¸ºç©ºï¼Œè¿˜æ²¡æœ‰é”™é¢˜å“¦ï¼',
      // å…¶ä»–åº”ç”¨/å¤–é“¾
      'periodic_table_app': 'æŒä¸Šå…ƒç´ å‘¨æœŸè¡¨',
      // å…¶ä»–é¡µé¢ç”¨åˆ°çš„é”®
      'please_complete_previous_lessons': 'è¯·å…ˆå®Œæˆå‰é¢çš„è¯¾ç¨‹',
      'basics_test': 'åŸºç¡€æµ‹è¯•',
      'chinese_morse_code': 'ä¸­æ–‡æ‘©å°”æ–¯ç”µç ',
      'chinese_code_test': 'ä¸­æ–‡ç”µç æµ‹è¯•'
    }

    // è‹±æ–‡å­—å…¸
    this.dictionaries['en-US'] = {
      // åº”ç”¨åŸºç¡€
      'app_name': 'Morse Code',
      'app_tagline': 'Make learning Morse code simple and fun',
      
      // ä¸»å¯¼èˆª
      'learn': 'Learn',
      'practice': 'Practice',
      'translate': 'Translate', 
      'code_table': 'Code Table',
      'me': 'Me',
      
      // é€šç”¨æ“ä½œ
      'confirm': 'Confirm',
      'cancel': 'Cancel',
      'close': 'OK',
      'back': 'Back',
      'next': 'Next',
      'loading': 'Loading...',
      'copied': 'Copied to clipboard',
      'got_it': 'Got it',
      'settings': 'Settings',
      'sound': 'Sound',
      
      // è¯­è¨€è®¾ç½®
      'language': 'Language',
      'language_selection_title': 'Select Language',
      'language_selection_content': 'Choose your preferred language for the app interface',
      'chinese': 'ä¸­æ–‡',
      'english': 'English',
      'language_switched': 'Language switched to English',
      'language_switch_failed': 'Language switch failed, please try again later',
      
      // å­¦ä¹ æ¨¡å—
      'morse_code_basics': 'Morse Code Basics',
      'morse_code_intro': 'Morse code is a character encoding system based on "dots (Â·) and dashes (-)". Different combinations of dots and dashes represent letters, numbers, and symbols.',
      'alphabet_lesson': 'Alphabet',
      'number_lesson': 'Number',
      'punctuation_lesson': 'Punctuation',
      'word_lesson': 'Word',
      'review_lesson': 'Review',
      'lesson_completed': 'Completed',
      'next_lesson': 'Next Lesson',
      'start_test': 'Start Test',
      'your_score': 'Your Score',
      'congratulations_passed': 'Congratulations!',
      'keep_trying': 'Keep trying!',
      
      // ç»ƒä¹ æ¨¡å—
      'easy': 'Easy',
      'medium': 'Medium',
      'hard': 'Hard',
      'easy_desc': 'Letters Only',
      'medium_desc': 'Letters + Numbers',
      'hard_desc': 'All Characters',
      'favorites': 'Favorites',
      'mistakes': 'Mistakes',
      'practice_again': 'Practice Again',
      'practice_count': 'Practice Count',
      'favorite_added': 'Added to favorites',
      'favorite_removed': 'Removed from favorites',
        'practice_records': 'Practice Records',
        'practiced': 'Practiced',
        'total': 'Total',
        'learning_completed': 'Learning Completed',
        
        // æµ‹è¯•é¡µé¢ç›¸å…³
        'you_mastered_basics': 'You have mastered the basics of Morse code',
        'need_100_to_pass': 'Need 100 points to pass the test',
        'test_your_mastery': 'Test your mastery of this lesson',
        'test_content': 'Test Content',
        'test_format_1': 'â€¢ 2 True/False questions (20 points each)',
        'test_format_2': 'â€¢ 3 Multiple choice questions (20 points each)',
        'retake_test': 'Retake Test',
        'next_question': 'Next Question',
        'view_results': 'View Results',
        'correct': 'Correct',
        'wrong': 'Wrong',
        
        // åŸºç¡€æµ‹è¯•é—®é¢˜å’Œé€‰é¡¹
        'q1_question': 'Morse code is a character encoding system based on "dots (Â·) and dashes (-)".',
        'q1_options': 'Correct,Wrong',
        'q2_question': 'The SOS signal in Morse code is Â·Â·Â· --- Â·Â·Â·, and normal character spacing should be maintained between characters.',
        'q2_options': 'Correct,Wrong',
        'q3_question': 'In Morse code timing rules, the unit ratio of dots, dashes, and character spacing is:',
        'q3_options': '1 : 2 : 5,1 : 3 : 7,1 : 4 : 8,2 : 3 : 6',
        'q4_question': 'In which era was Morse code developed?',
        'q4_options': '1820s,1830-1840s,1850s,1860s',
        'q5_question': 'The recommended learning order for Morse code is:',
        'q5_options': 'Numbers â†’ Letters â†’ Symbols,Symbols â†’ Letters â†’ Numbers,Letters â†’ Numbers â†’ Symbols,Random learning',
        
        // ä¸­æ–‡æ‘©æ–¯ç”µç æµ‹è¯•é—®é¢˜å’Œé€‰é¡¹
        'cq1_question': 'Chinese Morse code is a Morse code system specifically designed for Chinese characters.',
        'cq1_options': 'Correct,Wrong',
        'cq2_question': 'Chinese Morse code encoding is typically shorter than English Morse code.',
        'cq2_options': 'Correct,Wrong',
        'cq3_question': 'In which era was Chinese Morse code first established?',
        'cq3_options': '1900s,1920s,1950s,1980s',
        'cq4_question': 'Which of the following is NOT an application scenario for Chinese Morse code?',
        'cq4_options': 'Military communication,Aviation communication,Online chat,Maritime communication',
        'cq5_question': 'The recommended learning order for Chinese Morse code is:',
        'cq5_options': 'Start with complex characters,Start with basic characters,Random learning,Start with punctuation',
        
        // åŸºç¡€æµ‹è¯•è§£é‡Šå†…å®¹
        'exp1_title': 'Basic Elements of Morse Code',
        'exp1_content': 'â€¢ Morse code is based on "dots (Â·) and dashes (-)"\nâ€¢ Different combinations of dots and dashes represent letters, numbers, and symbols\nâ€¢ This is the foundation of all Morse code and must be mastered',
        'exp2_title': 'SOS Signal',
        'exp2_content': 'â€¢ SOS is an emergency distress signal that needs quick recognition\nâ€¢ Compact transmission: The three characters (Â·Â·Â· --- Â·Â·Â·) are sent compactly without normal character spacing\nâ€¢ Standard spacing rules: Normally, Morse code characters should have 3-unit spacing between them\nâ€¢ SOS exception: But SOS, as an emergency signal, ignores this rule and sends compactly for faster recognition',
        'exp3_title': 'Importance of Timing Rules',
        'exp3_content': 'â€¢ The 1:3:7 ratio is the core rule of Morse code\nâ€¢ Dot = 1 unit, Dash = 3 units, Character spacing = 3 units, Word spacing = 7 units\nâ€¢ This precise timing ensures accuracy and readability of information transmission',
        'exp4_title': 'Historical Background',
        'exp4_content': 'â€¢ Samuel Morse and Alfred Vail collaborated in the 1830-1840s\nâ€¢ Initially used for telegraph systems, later evolved into international Morse code\nâ€¢ Became the global standard for radio communication encoding',
        'exp5_title': 'Learning Strategy',
        'exp5_content': 'â€¢ Letters â†’ Numbers â†’ Symbols is the most scientific learning order\nâ€¢ Master basic letters first, then learn numbers and symbols\nâ€¢ Progressive learning to avoid information overload and improve efficiency',
        
        // ä¸­æ–‡æ‘©æ–¯ç”µç æµ‹è¯•è§£é‡Šå†…å®¹
        'cexp1_title': 'Definition of Chinese Morse Code',
        'cexp1_content': 'â€¢ Chinese Morse code is a coding system specifically designed for Chinese characters\nâ€¢ Uses combinations of dots (Â·) and dashes (-) to represent Chinese characters\nâ€¢ Combines traditional Morse code principles with Chinese language characteristics\nâ€¢ Provides standardized encoding for Chinese communication',
        'cexp2_title': 'Characteristics of Encoding Length',
        'cexp2_content': 'â€¢ Chinese Morse code encoding is typically longer than English Morse code\nâ€¢ This is because Chinese characters are numerous and require more dot-dash combinations\nâ€¢ Each Chinese character has a unique Morse code representation\nâ€¢ Increased encoding length ensures character uniqueness',
        'cexp3_title': 'Historical Development Background',
        'cexp3_content': 'â€¢ 1920s: Initial establishment of Chinese Morse code standards\nâ€¢ Developed to meet the needs of Chinese telegraph communication\nâ€¢ International Telecommunication Union (ITU) participated in development\nâ€¢ Modern standards formed through multiple optimizations',
        'cexp4_title': 'Application Scenario Analysis',
        'cexp4_content': 'â€¢ Military communication: Secret communication between troops\nâ€¢ Aviation communication: Communication between pilots and ground control towers\nâ€¢ Maritime communication: Communication between ships\nâ€¢ Online chat is not a traditional application scenario',
        'cexp5_title': 'Learning Strategy Recommendations',
        'cexp5_content': 'â€¢ Starting with basic characters is most scientific\nâ€¢ Basic characters are used frequently and easy to remember\nâ€¢ Progressive learning to avoid information overload\nâ€¢ Build learning confidence and improve efficiency',
      
      // ç¿»è¯‘æ¨¡å—
      'text_to_morse': 'Text â†’ Morse',
      'morse_to_text': 'Morse â†’ Text',
      'input_text_placeholder': 'Enter text here, e.g., Hello World',
      'input_morse_placeholder': 'Enter Morse here, e.g., Â·Â·Â· --- Â·Â·Â·',
      'output_text_placeholder': 'Morse will display here',
      'output_morse_placeholder': 'Text will display here',
      
      // ç è¡¨æ¨¡å—
      'standard_chinese_telegraph_code': 'Standard Chinese Telegraph Code',
      'chinese_characters': 'Chinese Characters',
      'telegraph_code': 'Telegraph Code',
      'searching': 'Searching...',
      'no_data': 'No Data',
      
      // ä¸ªäººä¸­å¿ƒ
      'rating_feedback': 'Rating & Feedback',
      'share_app': 'Share App',
      'other_apps': 'Other Apps',
      'version': 'Version',
      'copyright': 'Â© 2025 Douhua Technology Co., Ltd.',
      
      
      // åˆ†äº«å†…å®¹
      'share_text': 'Recommend a Morse code learning app:\nã€ŠMorse Code Masterã€‹ğŸ“¡\n\nâ€¢ Learn Morse code from scratch\nâ€¢ Follow-along practice and listening training\nâ€¢ Text and Morse code translation\n\nDownload now:\nhttps://appgallery.huawei.com/app/detail?id=com.douhua.morsecode',
      'share_copied': 'Share content copied to clipboard',
      
      // è¯¾ç¨‹æ ‡é¢˜ - æ¯ä¸ªå•å…ƒå†…éƒ¨ç¼–å·
      'lesson_1': 'Lesson 1',
      'lesson_2': 'Lesson 2',
      'lesson_3': 'Lesson 3', 
      'lesson_4': 'Lesson 4',
      'lesson_5': 'Lesson 5',
      'lesson_6': 'Lesson 6',
      'lesson_7': 'Lesson 7',
      'lesson_8': 'Lesson 8',
      'lesson_9': 'Lesson 9',
      'alphabet_abc': 'A B C',
      'alphabet_def': 'D E F',
      'alphabet_ghij': 'G H I J',
      'alphabet_review_aj': 'Review: A - J',
      'alphabet_klmn': 'K L M N',
      'alphabet_opqr': 'O P Q R',
      'alphabet_stuv': 'S T U V',
      'alphabet_wxyz': 'W X Y Z',
      'alphabet_review_kz': 'Review: K - Z',
      'numbers_123': '1 2 3',
      'numbers_456': '4 5 6',
      'numbers_7890': '7 8 9 0',
      'numbers_review': 'Review: 0-9',
      'punctuation_basic': '. , ? ! : ;',
      'punctuation_advanced': '= + - _ " \' ( ) / @',
      'punctuation_review': 'Review',
      'words_3letter': '3-Letter Words',
      'words_4letter': '4-Letter Words',
      'words_5letter': '5-Letter Words',
      'all_codes': 'All',
      'letters': 'Letters',
      'numbers': 'Numbers',
      'punctuation': 'Punctuation',
      'practice_favorites': 'Practice favorite letters',
      'mistakes_desc': 'Review wrong letters',
      'favorites_empty': 'Favorites is empty, go practice some letters first!',
      'mistakes_empty': 'No mistakes yet!',
      // Other apps / external links
      'periodic_table_app': 'Periodic Table',
      // Keys used by pages
      'please_complete_previous_lessons': 'Please complete the previous lessons first',
      'basics_test': 'Basics Test',
      'chinese_morse_code': 'Chinese Morse Code',
      'chinese_code_test': 'Chinese Code Test'
    }
  }

  /**
   * åˆå§‹åŒ–I18næœåŠ¡
   * @param context åº”ç”¨ä¸Šä¸‹æ–‡
   */
  async init(context: Context): Promise<void> {
    try {
      // åˆå§‹åŒ–Preferences
      this.preferences = await preferences.getPreferences(context, 'i18n_settings')
      
      // è¯»å–ä¿å­˜çš„è¯­è¨€è®¾ç½®
      const savedLang = await this.preferences.get('current_language', 'zh-CN') as string
      
      // éªŒè¯è¯­è¨€ä»£ç æœ‰æ•ˆæ€§
      if (this.isLanguageSupported(savedLang)) {
        this.currentLang = savedLang
      } else {
        // å°è¯•ä»ç³»ç»Ÿè¯­è¨€æ¨æ–­
        this.currentLang = this.detectSystemLanguage()
      }
      
      // è®¾ç½®åˆ°AppStorageï¼Œä¾›å…¨å±€è®¿é—®
      AppStorage.setOrCreate('currentLanguage', this.currentLang)
      
      console.log('[I18nService] Initialized with language:', this.currentLang)
    } catch (error) {
      console.error('[I18nService] Failed to initialize:', error)
      // é»˜è®¤ä¸­æ–‡
      this.currentLang = 'zh-CN'
      AppStorage.setOrCreate('currentLanguage', this.currentLang)
    }
  }

  /**
   * è·å–ç¿»è¯‘æ–‡æœ¬
   * @param key ç¿»è¯‘é”®
   * @param params æ¨¡æ¿å‚æ•°ï¼ˆå¯é€‰ï¼‰
   * @returns ç¿»è¯‘åçš„æ–‡æœ¬
   */
  t(key: string, params?: TemplateParams): string {
    const dictionary = this.dictionaries[this.currentLang]
    if (!dictionary) {
      console.warn(`[I18nService] Dictionary not found for language: ${this.currentLang}`)
      return key
    }

    let text = dictionary[key]
    if (!text) {
      console.warn(`[I18nService] Translation key not found: ${key}`)
      return key
    }

    // å¤„ç†æ¨¡æ¿å‚æ•°
    if (params) {
      const paramKeys = Object.keys(params)
      for (let i = 0; i < paramKeys.length; i++) {
        const paramKey = paramKeys[i]
        const placeholder = `{${paramKey}}`
        const paramValue = params[paramKey]
        text = text.replace(new RegExp(placeholder, 'g'), String(paramValue))
      }
    }

    return text
  }

  /**
   * åˆ‡æ¢è¯­è¨€
   * @param languageCode ç›®æ ‡è¯­è¨€ä»£ç 
   */
  async setLanguage(languageCode: string): Promise<void> {
    try {
      if (!this.isLanguageSupported(languageCode)) {
        console.error(`Unsupported language: ${languageCode}`)
        return
      }

      if (languageCode === this.currentLang) {
        return // è¯­è¨€ç›¸åŒï¼Œæ— éœ€åˆ‡æ¢
      }

      // æ›´æ–°å½“å‰è¯­è¨€
      this.currentLang = languageCode
      
      // è¯­è¨€åˆ‡æ¢å·²ç»Ÿä¸€åˆ° I18nServiceï¼Œæ— éœ€åŒæ­¥å…¶ä»–æœåŠ¡
      
      // æ›´æ–°AppStorageï¼Œè§¦å‘UIé‡æ–°æ¸²æŸ“
      AppStorage.setOrCreate('currentLanguage', this.currentLang)
      
      // å¼ºåˆ¶è§¦å‘UIåˆ·æ–° - é€šè¿‡ä¸´æ—¶æ”¹å˜å†æ¢å¤çš„æ–¹å¼
      const tempKey = 'languageRefreshTrigger'
      const currentTrigger = AppStorage.get<number>(tempKey) || 0
      AppStorage.setOrCreate(tempKey, currentTrigger + 1)

      // å¼‚æ­¥ä¿å­˜åˆ°Preferences
      if (this.preferences) {
        await this.preferences.put('current_language', languageCode)
        await this.preferences.flush()
      }
      
      console.log('[I18nService] Language switched to:', languageCode)
    } catch (error) {
      console.error('[I18nService] Failed to switch language:', error)
    }
  }

  /**
   * è·å–å½“å‰è¯­è¨€
   * @returns å½“å‰è¯­è¨€ä»£ç 
   */
  getCurrentLanguage(): string {
    return this.currentLang
  }

  /**
   * è·å–æ”¯æŒçš„è¯­è¨€åˆ—è¡¨
   * @returns æ”¯æŒçš„è¯­è¨€é€‰é¡¹æ•°ç»„
   */
  getSupportedLanguages(): LanguageOption[] {
    return [...this.supportedLanguages]
  }

  /**
   * åˆ¤æ–­æ˜¯å¦ä¸ºä¸­æ–‡
   * @returns æ˜¯å¦ä¸ºä¸­æ–‡
   */
  isChinese(): boolean {
    return this.currentLang.startsWith('zh')
  }

  /**
   * åˆ¤æ–­æ˜¯å¦ä¸ºè‹±æ–‡
   * @returns æ˜¯å¦ä¸ºè‹±æ–‡
   */
  isEnglish(): boolean {
    return this.currentLang.startsWith('en')
  }

  /**
   * æ£€æŸ¥è¯­è¨€æ˜¯å¦æ”¯æŒ
   * @param languageCode è¯­è¨€ä»£ç 
   * @returns æ˜¯å¦æ”¯æŒ
   */
  private isLanguageSupported(languageCode: string): boolean {
    return this.supportedLanguages.some(lang => lang.code === languageCode)
  }

  /**
   * æ£€æµ‹ç³»ç»Ÿè¯­è¨€
   * @returns ç³»ç»Ÿè¯­è¨€ä»£ç 
   */
  private detectSystemLanguage(): string {
    // é»˜è®¤è¿”å›ä¸­æ–‡
    return 'zh-CN'
  }

  /**
   * æ·»åŠ æˆ–æ›´æ–°å­—å…¸æ¡ç›®
   * @param languageCode è¯­è¨€ä»£ç 
   * @param key ç¿»è¯‘é”®
   * @param value ç¿»è¯‘å€¼
   */
  addTranslation(languageCode: string, key: string, value: string): void {
    if (!this.dictionaries[languageCode]) {
      this.dictionaries[languageCode] = {}
    }
    this.dictionaries[languageCode][key] = value
  }

  /**
   * æ‰¹é‡æ·»åŠ ç¿»è¯‘
   * @param languageCode è¯­è¨€ä»£ç 
   * @param translations ç¿»è¯‘å¯¹è±¡
   */
  addTranslations(languageCode: string, translations: Dictionary): void {
    if (!this.dictionaries[languageCode]) {
      this.dictionaries[languageCode] = {}
    }
    // æ‰‹åŠ¨åˆå¹¶å¯¹è±¡å±æ€§ï¼Œé¿å…ä½¿ç”¨ Object.assign å’Œ for...in
    const keys = Object.keys(translations)
    for (let i = 0; i < keys.length; i++) {
      const key = keys[i]
      this.dictionaries[languageCode][key] = translations[key]
    }
  }
}

// å¯¼å‡ºå•ä¾‹å®ä¾‹
export const i18nService = I18nService.getInstance()

// å¯¼å‡ºå…¨å±€ç¿»è¯‘å‡½æ•°ï¼Œæ–¹ä¾¿ä½¿ç”¨
export const t = (key: string, params?: TemplateParams): string => {
  return i18nService.t(key, params)
}
